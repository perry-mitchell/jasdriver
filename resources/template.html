<html>
    <head>
        <title>Jasmine test w/ Webdriver</title>
        <script type="text/javascript">
            window.jasDriverLogs = [];
            window.resultIndent = 0;
            (function init() {
                var oldLog = console.log,
                    oldWarn = console.warn,
                    oldError = console.error;
                console.log = function() {
                    window.jasDriverLogs.push({
                        type: "log",
                        args: Array.prototype.slice.call(arguments)
                    });
                    oldLog.apply(console, arguments);
                };
                console.warn = function() {
                    window.jasDriverLogs.push({
                        type: "warning",
                        args: Array.prototype.slice.call(arguments)
                    });
                    oldWarn.apply(console, arguments);
                };
                console.error = function() {
                    window.jasDriverLogs.push({
                        type: "error",
                        args: Array.prototype.slice.call(arguments)
                    });
                    oldError.apply(console, arguments);
                };

                if (window.addEventListener) {
                    window.addEventListener("error", function(evt) {
                        var err = {
                            name: "Error",
                            message: evt.message
                        };
                        window.jasDriverLogs.push({
                            type: "error",
                            args: [evt.error || err]
                        })
                    });
                } else {
                    window.onerror = function(msg, url, line, col, error) {
                        window.jasDriverLogs.push({
                            type: "error",
                            args: [msg, url + " (" + line + "," + col + ")", error]
                        })
                    };
                }

                window.fetchLogs = function() {
                    if (window.jasDriverLogs.length > 0) {
                        var fetchedLogs = [].concat(window.jasDriverLogs);
                        window.jasDriverLogs = [];
                        return fetchedLogs;
                    }
                    return [];
                };
                window.testPassed = 0;
                window.testFailed = 0;
                window.testSkipped = 0;
                window.testCompleted = false;
                window.getStats = function() {
                    return {
                        passed: window.testPassed,
                        failed: window.testFailed,
                        skipped: window.testSkipped
                    };
                };
            })();
        </script>
        <!-- JASMINE_SETUP -->
    </head>
    <body>
        <!-- Jasdriver -->
        <script type="text/javascript">
            jasmine.getEnv().addReporter({
                specStarted: function(result) {
                    //console.log("Running:", result.description + "...");
                },
                specDone: function(result) {
                    window.jasDriverLogs.push({
                        type: "spec_result",
                        args: [result.description, result.status, window.resultIndent]
                    });
                    switch (result.status) {
                        case "passed":
                            window.testPassed += 1;
                            break;
                        case "failed":
                            window.testFailed += 1;
                            break;
                        case "pending":
                            /* falls-through */
                        default:
                            window.testSkipped += 1;
                    }
                },
                suiteStarted: function(result) {
                    window.resultIndent += 1;
                    window.jasDriverLogs.push({
                        type: "suite",
                        args: [result.description]
                    });
                },
                suiteDone: function(result) {
                    window.resultIndent -= 1;
                }
            });
            afterAll(function() {
                window.testCompleted = true;
            });
        </script>
        <!-- JASMINE_SPECS -->
    </body>
</html>
